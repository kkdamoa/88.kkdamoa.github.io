<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- 카카오 SDK 초기화 -->
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        // 카카오 SDK 초기화 코드
        Kakao.init('1a44c2004824d4e16e69f1fc7e81d82c'); // 카카오 JavaScript 키 초기화
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연인 유형 설문조사</title>
    <link rel="stylesheet" href="연인.css"> <!-- 외부 CSS 파일을 연결 -->
    <style>
        /* 기본 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        header {
            text-align: center;
        }

        header h1 {
            margin-bottom: 20px;
        }

        header p {
            margin: 5px 0;
        }

        /* 버튼 스타일 */
        #startTest {
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        #startTest:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }
        
        #startTest:focus {
            outline: none;
        }

        /* 설문조사 섹션 */
        .hidden {
            display: none;
        }

        .progress-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: #4caf50;
            text-align: center;
            color: white;
            border-radius: 5px;
        }

        .question {
            margin-bottom: 20px;
        }

        .question p {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .radioContainer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .radioContainer span {
            width: 150px;
            text-align: center;
        }

        .labelContainer {
            position: relative;
            padding-left: 35px;
            cursor: pointer;
            user-select: none;
        }

        .labelContainer input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkmark {
            position: absolute;
            top: 50%;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
            transform: translateY(-50%);
            border-radius: 50%;
        }

        .labelContainer:hover input ~ .checkmark {
            background-color: #ccc;
        }

        .labelContainer input:checked ~ .checkmark {
            background-color: #007bff;
        }

        /* 결과 보기 버튼 */
        #showResultButton {
            padding: 10px 20px;
            font-size: 16px;
            display: none;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* 팝업 스타일 */
        .popup {
            display: none; /* 기본적으로 팝업은 숨김 */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            z-index: 1000;
        }

        /* 배경 클릭 시 팝업 닫기 */
        .popup-overlay {
            display: none; /* 기본적으로 배경은 숨김 */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* 버튼 스타일 */
        .open-popup-btn,
        .confirm-popup-btn {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        .confirm-popup-btn {
            display: none; /* 초기에는 숨김 */
            background-color: green;
        }

        /* 카운터 스타일 */
        .counter {
            font-size: 20px;
            margin-top: 10px;
            font-weight: bold;
        }

        /* 공유 버튼 스타일 */
        .social-share {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .share-button {
            display: inline-block;
        }

        .share-icon {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
    </style>
</head>

<body>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9374368296307755"
    crossorigin="anonymous"></script>
    
    <!-- 광고 삽입 -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-9374368296307755"
         data-ad-slot="3201247599"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <header>
        <h1>연인 유형 설문조사</h1>

        <p>"이 설문조사는 당신의 연인 유형을 파악하기 위해 고안되었습니다.</p>
        <p>각 질문에 솔직하게 응답해 주세요."</p>
        <button id="startTest">테스트 시작 ➔</button>
    </header>

    <main id="testSection" class="hidden">
        <!-- 진행 바 -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>

        <!-- 질문 표시 영역 -->
        <div id="questionContainer"></div>

        <!-- 결과 보기 버튼 -->
        <button id="showResultButton">결과 보기</button>
    </main>

    <!-- 결과 섹션 -->
    <div id="resultSection" class="hidden">
        <h2>테스트 결과</h2>
        <p id="resultText"></p>
        <button id="restartTest">다시 테스트하기</button>
    </div>

    <!-- 팝업 배경 -->
    <div class="popup-overlay"></div>

    <!-- 팝업 콘텐츠 -->
    <div class="popup">
        <div id="adsense-container"></div>
        <div class="counter" id="counter">결과값 분석중입니다.</div>
        <button class="confirm-popup-btn">확인</button>
    </div>

    <script>
        const startTestButton = document.getElementById('startTest');
        const testSection = document.getElementById('testSection');
        const questionContainer = document.getElementById('questionContainer');
        const showResultButton = document.getElementById('showResultButton');
        const resultSection = document.getElementById('resultSection');
        const resultText = document.getElementById('resultText');
        const popup = document.querySelector('.popup');
        const popupOverlay = document.querySelector('.popup-overlay');
        const confirmPopupBtn = document.querySelector('.confirm-popup-btn');
        const adsenseContainer = document.querySelector('#adsense-container');
        const counter = document.querySelector('#counter');
        const progressBar = document.getElementById('progressBar');
        const restartTestButton = document.getElementById('restartTest');

        // 각 유형에 대한 점수
        let scores = {
            type1: 0, // 미련형
            type2: 0, // 분노형
            type3: 0, // 후회형
            type4: 0, // 무덤덤형
            type5: 0  // 무감정형(공허·냉소)
        };

        // 각 질문에 대한 점수 매핑 (각 유형별로 9개의 질문)
        const questionTypeMapping = {
            1: 'type1', 2: 'type1', 3: 'type1', 4: 'type1', 5: 'type1', 6: 'type1', 7: 'type1', 8: 'type1', 9: 'type1',
            10: 'type2', 11: 'type2', 12: 'type2', 13: 'type2', 14: 'type2', 15: 'type2', 16: 'type2', 17: 'type2', 18: 'type2',
            19: 'type3', 20: 'type3', 21: 'type3', 22: 'type3', 23: 'type3', 24: 'type3', 25: 'type3', 26: 'type3', 27: 'type3',
            28: 'type4', 29: 'type4', 30: 'type4', 31: 'type4', 32: 'type4', 33: 'type4', 34: 'type4', 35: 'type4', 36: 'type4',
            37: 'type5', 38: 'type5', 39: 'type5', 40: 'type5', 41: 'type5', 42: 'type5', 43: 'type5', 44: 'type5', 45: 'type5'
        };

        // 45개 질문 배열
        const questions = [
            // type1: 질문 1-9
            "헤어진 후에도 상대방의 SNS를 확인한 적이 있나요?",
            "연락을 끊어야 한다고 생각하면서도 메시지를 보내고 싶은 충동을 느낀 적이 있나요?",
            "혹시라도 다시 만날 수 있을 거라는 희망을 가지고 있나요?",
            "헤어진 연인의 주변 사람들과 우연히라도 마주치고 싶은 생각이 드나요?",
            "과거 함께한 추억을 자주 떠올리거나 미화해서 생각하나요?",
            "다른 연애를 시작하기보다 전 연인과의 관계 회복이 더 중요하다고 느끼나요?",
            "상대방이 나를 어떻게 생각할지 고민하거나 궁금해한 적이 있나요?",
            "전 연인과의 재회를 상상하며 대화를 연습하거나 상황을 만들어 본 적이 있나요?",
            "헤어졌다는 사실을 받아들이기보다, 아직 끝나지 않았다는 생각이 드나요?",
            
            // type2: 질문 10-18
            "이별 후 분노를 느낀 적이 자주 있나요?",
            "전 연인에게 복수하고 싶은 마음이 든 적이 있나요?",
            "이별을 이유 없이 화를 내는 경우가 많았나요?",
            "전 연인의 잘못을 계속해서 떠올리며 화를 내나요?",
            "이별 후에도 상대방에게 화풀이를 하고 싶은 마음이 있나요?",
            "이별에 대해 자주 불평하거나 불만을 표출하나요?",
            "이별을 극복하지 못하고 계속해서 분노를 느끼나요?",
            "이별 후 감정을 조절하는데 어려움을 겪고 있나요?",
            "이별에 대한 분노로 일상생활에 지장을 받는 경우가 있나요?",
            
            // type3: 질문 19-27
            "이별을 후회하는 마음이 자주 드나요?",
            "전 연인과의 시간을 되돌리고 싶은 생각이 있나요?",
            "이별을 결정한 것에 대해 후회하는 경우가 많나요?",
            "전 연인에게 다시 돌아가고 싶은 마음이 있나요?",
            "이별을 받아들이기 어려워 자주 후회하나요?",
            "이별 후 자주 후회스러운 생각을 하나요?",
            "전 연인과의 선택에 대해 계속해서 후회하나요?",
            "이별을 한 것에 대해 스스로를 탓하는 경우가 많나요?",
            "이별을 결정한 것에 대해 깊이 후회하고 있나요?",
            
            // type4: 질문 28-36
            "이별 후 크게 신경 쓰지 않고 일상생활을 잘 유지하나요?",
            "이별을 별다른 감정 없이 받아들이고 있나요?",
            "이별 후 새로운 연애에 큰 관심이 없나요?",
            "이별을 했지만 특별한 감정의 변화가 없나요?",
            "이별 후 자신의 감정을 크게 느끼지 않나요?",
            "이별을 겪었지만 금방 일상으로 돌아갔나요?",
            "이별 후에도 별다른 감정의 흔적이 남아있지 않나요?",
            "이별을 경험했지만 크게 신경 쓰지 않나요?",
            "이별 후 자신의 감정을 조절하는데 문제가 없나요?",
            
            // type5: 질문 37-45
            "이별 후 무감정 상태가 지속되고 있나요?",
            "이별을 경험한 후 공허함을 느끼고 있나요?",
            "이별 후 냉소적인 태도를 취하고 있나요?",
            "이별 후 감정을 표현하는데 어려움을 겪고 있나요?",
            "이별을 겪은 후 감정이 마비된 느낌이 드나요?",
            "이별 후 주변 사람들과의 관계에 무관심한가요?",
            "이별 후 삶에 대한 흥미를 잃은 것 같나요?",
            "이별을 겪은 후 미래에 대한 기대가 없어졌나요?",
            "이별 후 자신을 완전히 감정적으로 닫아버렸나요?"
        ];

        let currentQuestion = 1;
        const totalQuestions = 45;
        const answers = [];

        // 테스트 시작 버튼 클릭 시
        startTestButton.addEventListener('click', () => {
            startTestButton.style.display = 'none';
            testSection.classList.remove('hidden');
            showQuestion(currentQuestion);
            updateProgressBar();
        });

        // 질문 표시
        function showQuestion(questionNumber) {
            const questionText = questions[questionNumber - 1];
            questionContainer.innerHTML = `
                <div class="question" data-question="${questionNumber}">
                    <p>${questionNumber}. ${questionText}</p>
                    <div class="radioContainer">
                        <span class="false">아니요</span>
                        <label class="labelContainer">
                            <input name="currentQuestion" value="0" type="radio" required>
                            <span class="checkmark"></span>
                        </label>
                        <label class="labelContainer">
                            <input name="currentQuestion" value="1" type="radio">
                            <span class="checkmark"></span>
                        </label>
                        <label class="labelContainer">
                            <input name="currentQuestion" value="2" type="radio">
                            <span class="checkmark"></span>
                        </label>
                        <label class="labelContainer">
                            <input name="currentQuestion" value="3" type="radio">
                            <span class="checkmark"></span>
                        </label>
                        <label class="labelContainer">
                            <input name="currentQuestion" value="4" type="radio">
                            <span class="checkmark"></span>
                        </label>
                        <span class="true">예</span>
                    </div>
                </div>
            `;

            // 라디오 버튼에 이벤트 리스너 추가
            document.querySelectorAll('.question input[type="radio"]').forEach(input => {
                input.addEventListener('change', handleAnswer);
            });

            // 진행 바 업데이트
            updateProgressBar();
        }

        // 진행 바 업데이트
        function updateProgressBar() {
            const percentage = (currentQuestion / totalQuestions) * 100;
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${Math.round(percentage)}%`;
        }

        // 라디오 버튼 선택 시 점수 누적 및 자동으로 다음 질문으로 이동
        function handleAnswer(event) {
            const selectedValue = parseInt(event.target.value);  // 선택된 값 가져오기

            // 선택된 값에 해당하는 점수 추가 (해당 유형에 점수 반영)
            const questionType = questionTypeMapping[currentQuestion];
            scores[questionType] += selectedValue;

            // 질문 번호 증가 후, 다음 질문 표시
            currentQuestion++;

            if (currentQuestion <= totalQuestions) {
                showQuestion(currentQuestion);
            } else {
                // 45번째 질문을 끝낸 후 "결과 보기" 버튼 표시
                showResultButton.classList.remove('hidden');
            }
        }

        // 결과 보기 버튼 클릭 시 결과 화면으로 전환
        showResultButton.addEventListener('click', () => {
            showResult();
        });

        // 결과 계산 및 표시
        function showResult() {
            let sortedScores = [];

            // 각 유형의 점수를 배열에 저장하여 내림차순으로 정렬
            for (let type in scores) {
                sortedScores.push({ type: type, score: scores[type] });
            }

            // 점수 내림차순으로 정렬
            sortedScores.sort((a, b) => b.score - a.score);

            // 결과 해석 추가
            let interpretation = interpretResults(sortedScores);

            // 결과 메시지 설정
            let resultMessage = `당신의 연인 유형은:<br><br>${interpretation}`;

            setTimeout(() => {
                resultText.innerHTML = resultMessage;
                resultSection.classList.remove('hidden');

                // 팝업 표시
                popup.style.display = 'block';
                popupOverlay.style.display = 'block';
                loadAd(); // 광고 로드
                startCountdown(); // 카운트다운 시작
            }, 5000); // 5초(5000ms) 후에 실행
        }

        // 결과 해석 함수
        function interpretResults(sortedScores) {
            let interpretation = '';

            sortedScores.forEach((item, index) => {
                let description = '';
                switch(item.type) {
                    case 'type1':
                        description = "미련형: 당신은 아직 마음속에서 전 연인에 대한 미련이 많이 남아있습니다.";
                        break;
                    case 'type2':
                        description = "분노형: 이별 후 분노를 자주 느끼며 감정을 조절하는데 어려움을 겪고 있습니다.";
                        break;
                    case 'type3':
                        description = "후회형: 이별을 후회하며 전 연인과의 관계를 되돌리고 싶어합니다.";
                        break;
                    case 'type4':
                        description = "무덤덤형: 이별을 크게 신경 쓰지 않고 일상생활을 잘 유지하고 있습니다.";
                        break;
                    case 'type5':
                        description = "무감정형(공허·냉소): 이별 후 감정이 마비되거나 공허함을 느끼고 있습니다.";
                        break;
                    default:
                        description = "";
                }
                interpretation += `${index + 1}. ${description}<br>`;
            });

            return interpretation;
        }

        // 소셜 미디어 공유 버튼 추가
        function addShareButtons() {
            const shareButtons = [
                { id: 'facebookShare', alt: '페이스북 공유', icon: '/k-test/log/페이스북.png' },
                { id: 'instagramShare', alt: '인스타그램 공유', icon: '/k-test/log/인스타.png' },
                { id: 'twitterShare', alt: '트위터 공유', icon: '/k-test/log/트위터.png' },
                { id: 'urlShare', alt: 'URL 복사', icon: '/k-test/log/url.png' },     
            ];

            const resultSection = document.getElementById('resultSection');
            const shareContainer = document.createElement('div');
            shareContainer.classList.add('share-buttons');

            // 각 버튼을 생성하여 추가
            shareButtons.forEach(button => {
                const buttonElement = document.createElement('button');
                buttonElement.id = button.id;
                buttonElement.classList.add('share-button');
                buttonElement.innerHTML = `<img src="${button.icon}" alt="${button.alt}" class="share-icon" />`;

                // 공유 버튼 클릭 이벤트
                buttonElement.addEventListener('click', () => {
                    shareContent(button.id);
                });

                shareContainer.appendChild(buttonElement);
            });

            // 공유 버튼을 결과 화면에 추가
            resultSection.appendChild(shareContainer);
        }

        // 콘텐츠 공유 함수 (각 소셜 미디어 버튼 클릭 시)
        function shareContent(platform) {
            const url = window.location.href;  // 현재 페이지 URL
            const text = '나의 연인 유형은? 확인해보세요!';

            switch(platform) {
                case 'facebookShare':
                    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
                    break;
                case 'instagramShare':
                    window.open(`https://www.instagram.com/?url=${encodeURIComponent(url)}`, '_blank');
                    break;
                case 'twitterShare':
                    window.open(`https://twitter.com/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
                    break;
                case 'urlShare':
                    navigator.clipboard.writeText(url).then(() => {
                        alert('URL이 복사되었습니다: ' + url);
                    }).catch(err => {
                        alert('URL 복사에 실패했습니다.');
                    });
                    break;
            }
        }

        // 유형 이름 반환 함수
        function getTypeName(type) {
            switch (type) {
                case 'type1': return '미련형';
                case 'type2': return '분노형';
                case 'type3': return '후회형';
                case 'type4': return '무덤덤형';
                case 'type5': return '무감정형(공허·냉소)';
                default: return '';
            }
        }

        // 자세히 알아보기 페이지로 이동
        function showDetailedPage(type) {
            // 각 유형에 맞는 페이지 URL 설정
            const pageUrls = {
                type1: 'https://testpro.site/k-test/연인/미련형',
                type2: 'https://testpro.site/k-test/연인/분노형',
                type3: 'https://testpro.site/k-test/연인/후회형',
                type4: 'https://testpro.site/k-test/연인/무덤덤형',
                type5: 'https://testpro.site/k-test/연인/무감정형'
            };

            // 해당 페이지로 이동
            window.location.href = pageUrls[type];
        }

        // 팝업 관련 이벤트
        confirmPopupBtn.addEventListener('click', () => {
            popup.style.display = 'none';
            popupOverlay.style.display = 'none';
            clearAd(); // 광고 제거
            clearInterval(countdown); // 카운트다운 정지
        });

        popupOverlay.addEventListener('click', () => {
            popup.style.display = 'none';
            popupOverlay.style.display = 'none';
            clearAd(); // 광고 제거
            clearInterval(countdown); // 카운트다운 정지
        });

        // 광고 로드 함수
        function loadAd() {
            const adScript = document.createElement('script');
            adScript.async = true;
            adScript.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9374368296307755";
            document.head.appendChild(adScript);

            const adContainer = document.createElement('ins');
            adContainer.classList.add('adsbygoogle');
            adContainer.style.display = 'block';
            adContainer.setAttribute('data-ad-client', 'ca-pub-9374368296307755');
            adContainer.setAttribute('data-ad-slot', '3201247599');
            adContainer.setAttribute('data-ad-format', 'auto');
            adContainer.setAttribute('data-full-width-responsive', 'true');

            adsenseContainer.appendChild(adContainer);

            (adsbygoogle = window.adsbygoogle || []).push({});
        }

        // 광고 제거 함수
        function clearAd() {
            adsenseContainer.innerHTML = '';
        }

        // 카운트다운 함수
        let countdown;
        function startCountdown() {
            let timeLeft = 7;
            counter.textContent = `${timeLeft}초 결과값 확인중입니다..`;

            countdown = setInterval(() => {
                timeLeft--;
                counter.textContent = `${timeLeft}초 결과값 확인중입니다..`;
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    counter.textContent = "결과값이 나왔습니다";
                    confirmPopupBtn.style.display = 'inline-block'; // 확인 버튼 표시

                    // 공유 버튼 표시
                    showSocialShare(); // 공유 버튼 표시 함수 호출
                }
            }, 1000);
        }

        // 공유 버튼 표시 함수
        function showSocialShare() {
            // 예시: 카카오톡 공유 버튼 추가
            const socialShareDiv = document.createElement('div');
            socialShareDiv.classList.add('social-share');

            // 카카오톡 공유 버튼
            const kakaoShareBtn = document.createElement('button');
            kakaoShareBtn.classList.add('share-button');
            kakaoShareBtn.innerHTML = '<img src="https://developers.kakao.com/assets/img/about/logos/kakaotalksharing/kakaotalk_sharing_btn_medium.png" alt="카카오톡 공유" class="share-icon">';
            kakaoShareBtn.addEventListener('click', () => {
                Kakao.Link.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: '연인 유형 설문조사 결과 공유',
                        description: resultText.textContent,
                        imageUrl: 'https://your-image-url.com/image.jpg', // 이미지 URL을 여기에 추가
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href
                        }
                    },
                    buttons: [
                        {
                            title: '결과 보기',
                            link: {
                                mobileWebUrl: window.location.href,
                                webUrl: window.location.href
                            }
                        }
                    ]
                });
            });

            socialShareDiv.appendChild(kakaoShareBtn);

            // 다른 소셜 미디어 공유 버튼도 추가 가능

            // 팝업에 추가
            popup.appendChild(socialShareDiv);
        }

        // 테스트 다시 시작 함수
        function resetTest() {
            currentQuestion = 1;
            scores = {
                type1: 0,
                type2: 0,
                type3: 0,
                type4: 0,
                type5: 0
            };
            resultSection.classList.add('hidden');
            showQuestion(currentQuestion);
            updateProgressBar();
        }

        // 다시 테스트하기 버튼 클릭 시
        restartTestButton.addEventListener('click', resetTest);
    </script>
</body>
</html>
